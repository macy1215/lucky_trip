import{S as x}from"./sweetalert2.all-Q0Og44KP.js";import{P as k}from"./PaginationView-H-5psX0m.js";import{_ as b,J as v,o as u,c as p,b as t,e as c,H as h,U as V,t as r,f,r as _,d as m,F as C,u as L}from"./index-sKjW6erJ.js";import{M as y}from"./modal-C_bFpHhU.js";import"./selector-engine-Tad2YfxP.js";var U={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_NAME:"lucky_trip",BASE_URL:"/lucky_trip/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:g,VITE_NAME:M}=U,N={props:["tempCoupons","isNew","clearInput"],emits:["update-coupon"],data(){return{couponModal:null,localTempCoupons:{},due_date:""}},methods:{showModal(){this.couponModal.show()},hideModal(){this.couponModal.hide()},setDueDate(){if(this.isNew===!0)this.due_date=this.localTempCoupons.getCurrentDate(),console.log("這個你",this.due_date);else{const s=new Date(this.tempCoupons.due_date*1e3),o=s.getFullYear(),n=String(s.getMonth()+1).padStart(2,"0"),d=String(s.getDate()).padStart(2,"0");this.due_date=`${o}/${n}/${d}`,console.log(this.due_date,this.year,this.month,this.date)}},getCurrentDate(){const s=new Date,o=s.getFullYear(),n=String(s.getMonth()+1).padStart(2,"0"),d=String(s.getDate()).padStart(2,"0");return`${o}/${n}/${d}`},updateCoupon(s){this.isLoading=!0,this.fullpage=!0;let o=`${g}/api/${M}/admin/coupon`,n="post",d=s;this.isNew||(o=`${g}/api/${M}/admin/coupon/${this.tempCoupons.id}`,n="put",d=this.tempCoupons),v[n](o,{data:d}).then(e=>{this.isLoading=!1,this.fullpage=!1,alert(e.data.message),this.getCoupon(),this.hideModal(),this.$refs.couponModal.hideModal(),this.$emit("update")}).catch(e=>{this.isLoading=!1,this.fullpage=!1,alert(e.response.data.message)})}},watch:{tempCoupons:{handler(){this.localTempCoupons=this.tempCoupons,console.log(this.localTempCoupons.due_date)},deep:!0},due_date(){this.localTempCoupons.due_date=Math.floor(new Date(this.due_date)/1e3)}},mounted(){this.couponModal=new y(this.$refs.couponModal,{keyboard:!1,backdrop:"static"}),this.localTempCoupons=this.tempCoupons,this.setDueDate()}},S={id:"couponModal",ref:"couponModal",class:"modal fade",tabindex:"-1","aria-labelledby":"couponLabel","aria-hidden":"true"},I={class:"modal-dialog modal-xl"},R={class:"modal-content border-0"},A={class:"modal-header bg-dark text-white"},P={id:"couponLabel",class:"modal-title"},B={key:0},O={key:1},F=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Y={class:"modal-body"},j={class:"row"},H={class:"col-sm-12"},J={class:"mb-3 text-start"},q=t("label",{for:"title",class:"form-label"},"優惠券標題",-1),z={class:"row text-start"},G={class:"mb-3 col-md-6"},K=t("label",{for:"category",class:"form-label"},"優惠卷代碼",-1),Q={class:"mb-3 col-md-6"},W=t("label",{for:"unit",class:"form-label"},"折扣百分比",-1),X={class:"row text-start"},Z={class:"mb-3 col-md-6"},tt=t("label",{for:"dueDate",class:"form-label"},"到期日",-1),ot={class:"mb-3 text-start"},et={class:"form-check"},st=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),nt={class:"modal-footer"},lt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function at(s,o,n,d,e,a){return u(),p("div",S,[t("div",I,[t("div",R,[t("div",A,[t("h5",P,[n.isNew?(u(),p("span",B,"新增優惠卷")):(u(),p("span",O,"編輯優惠卷"))]),F]),t("div",Y,[t("div",j,[t("div",H,[t("div",J,[q,c(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":o[0]||(o[0]=l=>e.localTempCoupons.title=l)},null,512),[[h,e.localTempCoupons.title]])]),t("div",z,[t("div",G,[K,c(t("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入代碼","onUpdate:modelValue":o[1]||(o[1]=l=>e.localTempCoupons.code=l)},null,512),[[h,e.localTempCoupons.code]])]),t("div",Q,[W,c(t("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入數字","onUpdate:modelValue":o[2]||(o[2]=l=>e.localTempCoupons.percent=l)},null,512),[[h,e.localTempCoupons.percent,void 0,{number:!0}]])])]),t("div",X,[t("div",Z,[tt,c(t("input",{id:"dueDate",type:"number",min:"0",class:"form-control","onUpdate:modelValue":o[3]||(o[3]=l=>e.due_date=l)},null,512),[[h,e.due_date]])])]),t("div",ot,[t("div",et,[c(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[4]||(o[4]=l=>e.localTempCoupons.is_enabled=l),"true-value":1,"false-value":0},null,512),[[V,e.localTempCoupons.is_enabled]]),st])])])])]),t("div",nt,[lt,t("button",{type:"button",class:"btn btn-primary",onClick:o[5]||(o[5]=l=>s.updateDateModal(e.localTempCoupons))},r(n.isNew?"新增優惠卷":"更新優惠券"),1)])])])],512)}const dt=b(N,[["render",at]]);var it={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_NAME:"lucky_trip",BASE_URL:"/lucky_trip/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:ut,VITE_NAME:pt}=it,ct={props:["coupons","tempCoupons","getCoupon"],data(){return{delCouponModal:null,data:""}},methods:{showModal(){this.delCouponModal.show()},hideModal(){this.delCouponModal.hide()},deleteCoupon(){const s=`${ut}/api/${pt}/admin/coupon/${this.tempCoupons.id}`;v.delete(s,{data:this.tempCoupons}).then(o=>{alert(o.data.message),this.hideModal(),this.$emit("update")}).catch(o=>{alert(o.response.data.message)})}},mounted(){this.delCouponModal=new y(this.$refs.delCouponModal,{keyboard:!1,backdrop:"static"}),console.log(this.tempCoupons)}},rt={id:"delCouponModal",ref:"delCouponModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},ht={class:"modal-dialog"},_t={class:"modal-content border-0"},mt=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delCouponModalLabel",class:"modal-title"},[t("span",null,"刪除優惠卷")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),bt={class:"modal-body text-start"},ft=t("strong",{class:"text-danger"},[t("span",{class:"fw-bold"})],-1),Ct=t("div",{class:"mt-2"}," (刪除後將無法恢復)。 ",-1),gt={class:"modal-footer"},Mt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function vt(s,o,n,d,e,a){return u(),p("div",rt,[t("div",ht,[t("div",_t,[mt,t("div",bt,[f(" 是否刪除 "),ft,f(" "+r(n.tempCoupons.title)+" 優惠券 ",1),Ct]),t("div",gt,[Mt,t("button",{type:"button",class:"btn btn-danger",onClick:o[0]||(o[0]=(...l)=>a.deleteCoupon&&a.deleteCoupon(...l))}," 確認刪除 ")])])])],512)}const yt=b(ct,[["render",vt]]);var wt={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_NAME:"lucky_trip",BASE_URL:"/lucky_trip/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:$t,VITE_NAME:Dt}=wt,Et={data(){return{isLoading:!1,fullpage:!1,coupons:[],tempCoupons:{},pagination:{},isNew:!1}},components:{Pagination:k,ModalCoupon:dt,ModalDelCoupon:yt},methods:{getCoupon(s=1){this.isLoading=!0,this.fullpage=!0;const o=`${$t}/api/${Dt}/admin/coupons?page=${s}`;this.$http.get(o).then(n=>{this.coupons=n.data.coupons,this.isLoading=!1,this.fullpage=!1,this.pagination=n.data.pagination,x.fire({position:"top-end",icon:"success",title:"成功取得優惠卷資訊",showConfirmButton:!1,timer:1500})}).catch(n=>{console.log(n),this.$router.push("/login")})},formatDate(s){return new Date(s*1e3).toLocaleDateString()},openCouponModal(s,o){s==="createNew"?(this.tempCoupon={due_date:Math.floor(new Date().getTime()/1e3),is_enabled:0},this.isNew=!0,this.$refs.couponModal.showModal()):s==="edit"?(this.tempCoupons={...o},this.isNew=!1,this.$refs.couponModal.showModal()):s==="delete"&&(this.tempCoupons={...o},this.$refs.couponDelModal.showModal())},clearInput(){this.tempCoupons={}}},mounted(){this.getCoupon()}},Tt={class:"container"},xt={class:"d-flex justify-content-between mt-4"},kt=t("h2",{class:"text-primary mb-3 h2 text-start col-6"},"優惠卷列表",-1),Vt={class:"table table-hover border rounded rounded-3 mt-4"},Lt=t("thead",null,[t("tr",null,[t("th",null,"名稱"),t("th",null,"折扣百分比"),t("th",null,"到期日"),t("th",null,"是否啟用"),t("th",null,"編輯")])],-1),Ut={key:0,class:"text-success"},Nt={key:1,class:"text-muted"},St={class:"btn-group"},It=["onClick"],Rt=["onClick"];function At(s,o,n,d,e,a){const l=_("VueLoading"),w=_("Pagination"),$=_("ModalCoupon"),D=_("ModalDelCoupon");return u(),p(C,null,[m(l,{active:e.isLoading,"onUpdate:active":o[0]||(o[0]=i=>e.isLoading=i),loader:"bars","is-full-page":e.fullpage},null,8,["active","is-full-page"]),t("div",Tt,[t("div",xt,[kt,t("button",{class:"btn btn-primary text-white fw-bold",type:"button",onClick:o[1]||(o[1]=i=>a.openCouponModal("createNew"))}," 建立新的優惠卷 ")]),t("table",Vt,[Lt,t("tbody",null,[(u(!0),p(C,null,L(e.coupons,(i,E)=>(u(),p("tr",{key:E},[t("td",null,r(i.title),1),t("td",null,r(i.percent)+"%",1),t("td",null,r(a.formatDate(i.due_date)),1),t("td",null,[i.is_enabled===1?(u(),p("span",Ut,"啟用")):(u(),p("span",Nt,"未啟用"))]),t("td",null,[t("div",St,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:T=>a.openCouponModal("edit",i)},"編輯",8,It),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:T=>a.openCouponModal("delete",i)},"刪除",8,Rt)])])]))),128))])]),m(w,{pagination:e.pagination,onEmitPages:a.getCoupon},null,8,["pagination","onEmitPages"])]),m($,{ref:"couponModal","temp-Coupons":e.tempCoupons,"is-new":e.isNew,"clear-input":a.clearInput,onUpdate:a.getCoupon},null,8,["temp-Coupons","is-new","clear-input","onUpdate"]),m(D,{ref:"couponDelModal","is-new":e.isNew,"temp-Coupons":e.tempCoupons,onUpdate:a.getCoupon},null,8,["is-new","temp-Coupons","onUpdate"])],64)}const jt=b(Et,[["render",At]]);export{jt as default};
